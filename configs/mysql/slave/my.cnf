[mysqld]
# Server ID duy nhất cho slave (phải khác master)
server-id = 2 # [important] - Unique server ID for slave (different from master)

# Cấu hình relay log
relay-log = mysql-relay-bin # [important] - Relay log file prefix for replication
relay-log-index = mysql-relay-bin.index # [important] - Relay log index file

# GTID settings (MUST BE ENABLED for auto position replication)
gtid-mode = ON # [important] - Must match master GTID setting
enforce-gtid-consistency = ON # [important] - Must match master GTID setting

# Repository cho master/source info 
master-info-repository = TABLE # [optional] - Store master info in table (MySQL < 8.0.23)
relay-log-info-repository = TABLE # [optional] - Store relay log info in table (MySQL < 8.0.23)
# MySQL 8.0.23+ settings (will be ignored by older MySQL versions)
source_info_repository = TABLE # Store source info in table (MySQL 8.0.23+)
relay_log_info_repository = TABLE # Store relay log info in table (MySQL 8.0.23+)

# GTID settings
gtid-mode = ON # [important] - Must match master GTID setting
enforce-gtid-consistency = ON # [important] - Must match master GTID consistency setting

# Replication settings (backwards compatible syntax)
skip-slave-start = TRUE # [important] - For MySQL < 8.0.23
skip_replica_start = TRUE # [important] - For MySQL 8.0.23+
read-only = ON # [optional] - Make replica read-only to prevent accidental writes
super-read-only = OFF # [fixed] - Allow replication setup by root user

# Bảo mật
skip-name-resolve = ON # [optional] - Skip DNS resolution for better performance
bind-address = 0.0.0.0 # [important] - Allow connections from any IP

# Character set
character-set-server = utf8mb4 # [optional] - Same character set as master
collation-server = utf8mb4_unicode_ci # [optional] - Same collation as master

# Performance
innodb_buffer_pool_size = 256M # [optional] - Same buffer pool size as master

# Replication update settings (backwards compatible syntax)
log-slave-updates = ON # [important] - For MySQL < 8.0.23
log_replica_updates = ON # [important] - For MySQL 8.0.23+

# Timeout settings (both legacy and modern syntax)
# For MySQL < 8.0.23
slave_net_timeout = 60
slave_parallel_workers = 4
slave_preserve_commit_order = ON

# For MySQL 8.0.23+
replica_net_timeout = 60
replica_parallel_workers = 4
replica_preserve_commit_order = ON